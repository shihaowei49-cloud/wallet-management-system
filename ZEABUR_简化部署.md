# 🚀 Zeabur 简化部署方案（不使用 Docker）

## 问题分析

Docker 部署可能遇到端口、配置等问题。我们改用**更简单的 Node.js 直接部署**。

---

## ✅ 新的部署方案

### 第一步：修改前端配置

前端不再使用 Docker + Nginx，改用简单的静态服务器。

#### 1. 删除不用的配置

在 Zeabur 前端服务设置中：
- **不要选择** "Use Dockerfile"
- 让 Zeabur 自动检测项目类型

#### 2. 确保环境变量正确

前端服务 → Variables → 添加：
```
VITE_API_URL=https://你的后端域名/api
```

**重要**：
- 必须用后端的完整域名
- 必须是 https://
- 必须有 /api 后缀

---

### 第二步：修改后端配置

#### 1. 检查后端环境变量

后端服务 → Variables → 确保有：
```
PORT=8080
NODE_ENV=production
JWT_SECRET=任意随机字符串
```

**注意**：Zeabur 期望端口是 8080，不是 5001！

---

## 📋 完整检查清单

### ✅ 必须完成的配置

#### 后端服务
- [ ] 已部署且状态为 "Running"
- [ ] PORT 环境变量设置为 **8080**
- [ ] NODE_ENV 设置为 **production**
- [ ] JWT_SECRET 已设置
- [ ] 已生成域名（例如：backend-xxx.zeabur.app）
- [ ] 访问 `https://后端域名/health` 能看到 `{"status":"ok"}`

#### 前端服务
- [ ] 已部署且状态为 "Running"
- [ ] VITE_API_URL 正确设置为后端地址
- [ ] 已生成域名
- [ ] 访问前端域名能看到页面

---

## 🔧 立即修复步骤

### 修复 1: 后端端口问题

**问题**：后端默认端口是 5001，但 Zeabur 需要 8080

**解决**：
1. 进入 Zeabur 后端服务
2. Variables → 编辑 PORT
3. 改为 **8080**
4. 点击 **Redeploy**

### 修复 2: 前端 API 地址

**问题**：前端不知道后端在哪里

**解决**：
1. 获取后端域名（例如：backend-abc.zeabur.app）
2. 进入前端服务 → Variables
3. 设置：
   ```
   VITE_API_URL=https://backend-abc.zeabur.app/api
   ```
4. 保存后自动重新部署

---

## 🎯 逐步验证

### 步骤 1: 验证后端

打开浏览器访问：
```
https://你的后端域名/health
```

**期望结果**：
```json
{
  "status": "ok",
  "timestamp": "2025-11-22T..."
}
```

**如果看不到**：
- 检查后端服务是否 Running
- 检查 Logs 标签有没有错误
- 确认 PORT=8080

### 步骤 2: 验证前端能访问后端

打开浏览器开发者工具（F12）→ Console

访问前端页面，在 Console 输入：
```javascript
fetch('/api/dashboard/stats').then(r => r.json()).then(console.log)
```

**期望结果**：
应该看到错误 "未提供认证令牌" 或者数据

**如果看不到**：
- VITE_API_URL 配置错误
- 需要重新部署前端

### 步骤 3: 测试登录

1. 访问前端域名
2. 输入：admin / admin123
3. 点击登录

**如果失败**：
- F12 查看 Network 标签
- 找到 `/api/auth/login` 请求
- 看请求 URL 是什么
- 看响应是什么

---

## 🆘 紧急救援方案

如果上面都不行，用这个最简单的方法：

### 方案 A: 只部署后端到 Zeabur

1. 只部署后端服务
2. 前端在本地运行
3. 修改本地前端的 API 地址为 Zeabur 后端

### 方案 B: 全部在本地运行

1. 两个服务都在本地
2. 先确保本地能正常工作
3. 再考虑部署

---

## 📞 告诉我当前状态

请回答以下问题，我会针对性解决：

1. **后端服务状态**：
   - [ ] Running（绿色）
   - [ ] Building（黄色）
   - [ ] Failed（红色）

2. **后端健康检查**：
   - 访问 `https://你的后端域名/health`
   - 能看到什么？

3. **前端服务状态**：
   - [ ] Running
   - [ ] Building
   - [ ] Failed

4. **前端访问**：
   - 访问前端域名看到什么？
   - 完全空白？
   - 登录页？
   - 错误信息？

5. **浏览器控制台**：
   - F12 → Console 标签
   - 有红色错误吗？
   - 错误内容是什么？

---

## 💡 最可能的问题

根据经验，最常见的问题是：

### 问题 1: 端口不对（90%）
**症状**：服务显示 Running，但访问 404
**解决**：后端 PORT=8080

### 问题 2: API 地址不对（80%）
**症状**：前端能访问，登录失败
**解决**：VITE_API_URL 必须是完整的后端地址

### 问题 3: 没有重新部署（70%）
**症状**：改了配置但没效果
**解决**：改完配置必须 Redeploy

---

## 🎬 录屏演示

如果文字说明不够清楚，我可以：
1. 提供详细的截图指南
2. 写一个自动化部署脚本
3. 推荐其他更简单的部署平台

**现在告诉我：**
1. 后端服务状态？
2. 访问 `/health` 看到什么？
3. 前端访问看到什么？

我会根据您的回答给出精确的解决方案！
