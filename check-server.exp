#!/usr/bin/expect -f

set timeout 30
set server_ip "43.133.241.218"
set username "administrator"
set password "Helen123!@#"

puts "\nğŸ” è¿æ¥åˆ°è…¾è®¯äº‘æœåŠ¡å™¨..."
puts "IP: $server_ip\n"

# è¿æ¥åˆ°æœåŠ¡å™¨
spawn ssh -o StrictHostKeyChecking=no $username@$server_ip

# ç­‰å¾…å¯†ç æç¤º
expect {
    "*password:" {
        send "$password\r"
    }
    timeout {
        puts "\nâŒ è¿æ¥è¶…æ—¶"
        exit 1
    }
}

# ç­‰å¾…ç™»å½•æˆåŠŸ
expect {
    "*administrator@*" {
        puts "\nâœ… SSHè¿æ¥æˆåŠŸï¼\n"
    }
    timeout {
        puts "\nâŒ ç™»å½•è¶…æ—¶"
        exit 1
    }
}

# æ‰§è¡Œæ£€æŸ¥å‘½ä»¤
send "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'\r"
expect "*administrator@*"

send "echo 'ğŸ–¥ï¸  æœåŠ¡å™¨ä¿¡æ¯'\r"
expect "*administrator@*"

send "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'\r"
expect "*administrator@*"

send "cat /etc/os-release | grep PRETTY_NAME\r"
expect "*administrator@*"

send "echo ''\r"
expect "*administrator@*"

send "echo 'ğŸ“¦ è½¯ä»¶ç¯å¢ƒ:'\r"
expect "*administrator@*"

send "echo -n 'Node.js: ' && node --version 2>/dev/null || echo 'âŒ æœªå®‰è£…'\r"
expect "*administrator@*"

send "echo -n 'npm: ' && npm --version 2>/dev/null || echo 'âŒ æœªå®‰è£…'\r"
expect "*administrator@*"

send "echo -n 'Git: ' && git --version 2>/dev/null || echo 'âŒ æœªå®‰è£…'\r"
expect "*administrator@*"

send "echo -n 'PM2: ' && pm2 --version 2>/dev/null || echo 'âŒ æœªå®‰è£…'\r"
expect "*administrator@*"

send "echo -n 'Nginx: ' && nginx -v 2>&1 | head -1 || echo 'âŒ æœªå®‰è£…'\r"
expect "*administrator@*"

send "echo ''\r"
expect "*administrator@*"

send "echo 'ğŸ’¾ ç£ç›˜ç©ºé—´:'\r"
expect "*administrator@*"

send "df -h | grep -E '^/dev/' | head -1\r"
expect "*administrator@*"

send "echo ''\r"
expect "*administrator@*"

send "echo 'ğŸ“ æ£€æŸ¥é¡¹ç›®ç›®å½•:'\r"
expect "*administrator@*"

send "ls -la /var/www/ 2>/dev/null | grep wallet || echo 'âŒ é¡¹ç›®æœªéƒ¨ç½²'\r"
expect "*administrator@*"

send "echo ''\r"
expect "*administrator@*"

send "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'\r"
expect "*administrator@*"

send "echo 'âœ… æ£€æŸ¥å®Œæˆ'\r"
expect "*administrator@*"

# é€€å‡º
send "exit\r"
expect eof

puts "\n"
