# 🚀 钱包系统 - 超简易部署指南

## ❓ 为什么这次部署比较困难？

### 打卡系统 vs 钱包系统

| 对比项 | 打卡系统（简单）| 钱包系统（复杂）|
|--------|----------------|----------------|
| 架构 | 单体应用 | 前后端分离 |
| 服务数量 | 1 个 | 2 个 |
| 端口配置 | 1 个端口 | 2 个端口 + 通信 |
| 通信方式 | 无需配置 | 需要 CORS + API 代理 |
| 部署难度 | ⭐ | ⭐⭐⭐ |

**核心问题**：前后端分离增加了部署复杂度

---

## ✅ 最简化方案（推荐）

### 方案 1: 单独部署后端，前端本地运行

这是**最简单**且**最稳定**的方式：

#### 步骤 1: 只部署后端到 Zeabur

1. 访问 https://zeabur.com
2. Create Project → `wallet-backend`
3. Add Service → Git → 选择仓库
4. **Root Directory**: `backend`
5. 环境变量：
   ```
   PORT=8080
   JWT_SECRET=随机字符串
   NODE_ENV=production
   ```
6. 生成域名（例如：backend-xxx.zeabur.app）

#### 步骤 2: 本地运行前端

```bash
cd /Users/shihao.eth/wallet-management-system/frontend

# 创建 .env.local 文件
echo "VITE_API_URL=https://backend-xxx.zeabur.app/api" > .env.local

# 安装依赖（如果还没安装）
npm install

# 启动前端
npm run dev
```

**访问**: http://localhost:3000

#### 优点
- ✅ 配置简单，不容易出错
- ✅ 后端在云端，前端本地开发
- ✅ 调试方便
- ✅ 成本低（只付后端费用）

---

### 方案 2: 简化的前端部署

如果一定要前端也部署到云端，用这个配置：

#### 修改前端部署方式

**不使用 Docker**，改用 Zeabur 的自动构建：

1. 在 Zeabur 前端服务设置
2. **Build Command**: `npm install && npm run build`
3. **Start Command**: `npx serve -s dist -l 8080`
4. **Output Directory**: `dist`
5. 环境变量：
   ```
   VITE_API_URL=https://backend-xxx.zeabur.app/api
   PORT=8080
   ```

#### 优点
- ✅ 不用 Docker，配置更简单
- ✅ Zeabur 自动检测 Vite 项目
- ✅ 端口统一为 8080

---

## 🔧 核心配置检查表

### 后端必须配置

- [ ] `PORT=8080` （必须是 8080）
- [ ] `JWT_SECRET` 已设置
- [ ] `NODE_ENV=production`
- [ ] 服务状态显示 "Running"
- [ ] 访问 `/health` 返回 `{"status":"ok"}`

### 前端必须配置

- [ ] `VITE_API_URL` 是完整的后端地址（包含 https:// 和 /api）
- [ ] 如果用 Docker，端口必须是 8080
- [ ] 构建成功，服务状态 "Running"

---

## 📋 完整的环境变量配置

### 后端 (Backend)

在 Zeabur 后端服务的 Variables 中添加：

```bash
PORT=8080
JWT_SECRET=请用下面命令生成一个随机字符串
NODE_ENV=production
```

生成 JWT_SECRET：
```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

### 前端 (Frontend)

**如果部署到 Zeabur**，在前端服务的 Variables 中添加：

```bash
VITE_API_URL=https://你的后端域名/api
```

**如果本地运行**，创建 `.env.local` 文件：

```bash
VITE_API_URL=https://你的后端域名/api
```

---

## 🎯 验证部署成功

### 1. 验证后端

```bash
# 访问健康检查
curl https://你的后端域名/health

# 应该返回
{"status":"ok","timestamp":"..."}
```

### 2. 验证登录接口

```bash
curl -X POST https://你的后端域名/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'

# 应该返回带 token 的响应
```

### 3. 访问前端

- 如果本地：http://localhost:3000
- 如果 Zeabur：https://你的前端域名

登录账号：
- 用户名：`admin`
- 密码：`admin123`

---

## 🆘 常见错误和解决

### 错误 1: 404 Not Found

**原因**: 端口配置错误
**解决**: 确保 PORT=8080

### 错误 2: CORS 错误

**原因**: 前端 API 地址不对
**解决**: VITE_API_URL 必须是完整地址

### 错误 3: 登录失败

**原因**: 后端没启动或 API 地址错误
**解决**: 先验证 `/health` 接口

### 错误 4: 白屏

**原因**: 前端构建失败
**解决**: 查看 Zeabur Logs 标签

---

## 💡 我的建议

**推荐流程**：

1️⃣ **先部署后端**
   - 只部署后端到 Zeabur
   - 确保 `/health` 可以访问
   - 记下后端域名

2️⃣ **本地测试前端**
   - 前端在本地运行
   - 连接云端后端
   - 确保功能正常

3️⃣ **最后部署前端**
   - 等本地测试通过后
   - 再部署前端到 Zeabur
   - 这样更容易排查问题

---

## 🎁 一键部署脚本（本地使用）

创建 `start-with-cloud-backend.sh`：

```bash
#!/bin/bash

# 后端域名（修改为你的实际域名）
BACKEND_URL="https://你的后端域名.zeabur.app"

# 创建前端环境变量
cd frontend
echo "VITE_API_URL=${BACKEND_URL}/api" > .env.local

# 安装依赖（如果需要）
if [ ! -d "node_modules" ]; then
    npm install
fi

# 启动前端
npm run dev
```

使用：
```bash
chmod +x start-with-cloud-backend.sh
./start-with-cloud-backend.sh
```

---

## 📞 需要帮助？

如果按照上面的**方案 1**（后端云端+前端本地）还是有问题：

**请告诉我**：
1. 后端域名是什么？
2. 访问 `/health` 看到什么？
3. 前端 console 报什么错？

我会立即帮您解决！

---

**建议：先用方案 1，确保能正常工作，再考虑全部署到云端。** 🚀
