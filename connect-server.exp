#!/usr/bin/expect -f

set timeout 120
set server_ip "43.133.241.218"
set username "administrator"
set password "Helen123!@#"

puts "\nğŸ”Œ å°è¯•è¿æ¥æœåŠ¡å™¨ï¼ˆè¶…æ—¶æ—¶é—´ï¼š120ç§’ï¼‰...\n"

# ä½¿ç”¨æ›´å®½æ¾çš„å‚æ•°è¿æ¥
spawn ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o ServerAliveInterval=60 -o TCPKeepAlive=yes -o ConnectTimeout=120 $username@$server_ip

# å¤„ç†å„ç§å¯èƒ½çš„æç¤º
expect {
    "*yes/no*" {
        send "yes\r"
        exp_continue
    }
    "*password:" {
        puts "âœ“ æ”¶åˆ°å¯†ç æç¤º"
        send "$password\r"
    }
    "*Password:" {
        puts "âœ“ æ”¶åˆ°å¯†ç æç¤º"
        send "$password\r"
    }
    timeout {
        puts "\nâŒ è¿æ¥è¶…æ—¶ï¼ˆ120ç§’ï¼‰"
        puts "\nå¯èƒ½åŸå› ï¼š"
        puts "1. æœåŠ¡å™¨æ˜¯Windowsç³»ç»Ÿï¼Œéœ€è¦ä½¿ç”¨è¿œç¨‹æ¡Œé¢"
        puts "2. SSHæœåŠ¡æœªå¯åŠ¨æˆ–é…ç½®æœ‰é—®é¢˜"
        puts "3. ç½‘ç»œé˜²ç«å¢™é™åˆ¶"
        exit 1
    }
    eof {
        puts "\nâŒ è¿æ¥è¢«æ‹’ç»"
        exit 1
    }
}

# ç­‰å¾…ç™»å½•æˆåŠŸ
expect {
    "*administrator@*" {
        puts "\nâœ… ç™»å½•æˆåŠŸï¼ˆLinuxæœåŠ¡å™¨ï¼‰\n"
        send "uname -a\r"
        expect "*administrator@*"
        send "cat /etc/os-release 2>/dev/null | grep PRETTY_NAME\r"
        expect "*administrator@*"
    }
    "*>" {
        puts "\nâœ… ç™»å½•æˆåŠŸï¼ˆWindowsæœåŠ¡å™¨ï¼‰\n"
        send "ver\r"
        expect "*>"
    }
    "C:*>" {
        puts "\nâœ… ç™»å½•æˆåŠŸï¼ˆWindowsæœåŠ¡å™¨ï¼‰\n"
        send "ver\r"
        expect "C:*>"
    }
    timeout {
        puts "\nâŒ ç™»å½•è¶…æ—¶"
        exit 1
    }
}

puts "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
puts "ä¿æŒè¿æ¥ï¼Œç­‰å¾…å‘½ä»¤..."

interact
