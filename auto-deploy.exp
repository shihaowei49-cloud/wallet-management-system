#!/usr/bin/expect -f

set timeout 30
set server_ip "43.133.241.218"
set username "administrator"
set password "Helen123!@#"

# è¿æ¥åˆ°æœåŠ¡å™¨
spawn ssh -o StrictHostKeyChecking=no $username@$server_ip

# ç­‰å¾…å¯†ç æç¤º
expect {
    "*password:" {
        send "$password\r"
    }
    timeout {
        puts "è¿æ¥è¶…æ—¶"
        exit 1
    }
}

# ç­‰å¾…ç™»å½•æˆåŠŸ
expect {
    "*administrator@*" {
        puts "\nâœ… SSHè¿æ¥æˆåŠŸï¼\n"
    }
    timeout {
        puts "ç™»å½•è¶…æ—¶"
        exit 1
    }
}

# æ‰§è¡Œç³»ç»Ÿä¿¡æ¯æŸ¥è¯¢
send "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'\r"
send "echo 'ğŸ–¥ï¸  æœåŠ¡å™¨ä¿¡æ¯'\r"
send "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'\r"
send "echo 'OS:' && cat /etc/os-release | grep PRETTY_NAME\r"
send "echo 'CPU:' && nproc\r"
send "echo 'Memory:' && free -h | grep Mem\r"
send "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'\r"
expect "*administrator@*"

# æ£€æŸ¥ç¯å¢ƒ
send "echo 'ğŸ“‹ æ£€æŸ¥ç¯å¢ƒ...'\r"
send "node --version 2>/dev/null || echo 'Node.js: æœªå®‰è£…'\r"
expect "*administrator@*"

send "git --version 2>/dev/null || echo 'Git: æœªå®‰è£…'\r"
expect "*administrator@*"

send "pm2 --version 2>/dev/null || echo 'PM2: æœªå®‰è£…'\r"
expect "*administrator@*"

send "nginx -v 2>&1 || echo 'Nginx: æœªå®‰è£…'\r"
expect "*administrator@*"

send "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'\r"
send "echo 'ç­‰å¾…ä¸‹ä¸€æ­¥æŒ‡ä»¤...'\r"

# ä¿æŒè¿æ¥
interact
